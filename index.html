<html>
<head>
  <link rel="stylesheet" href="css/pico.classless.amber.css">
</head>
<body>

  <details open>
    <summary><code>printer.cfg</code></summary>
    <button data-idx="1">+</button>
  </details>
  <dialog id="add_edit_block">
    <select id="block_type">
      <option>Mcu</option>
      <option>Printer</option>
      <option>Stepper</option>
      <option>Extruder</option>
    </select>
  </dialog>


<script type="module">
  const all = document.querySelectorAll.bind(document)
  const one = document.querySelector.bind(document)
  const add_edit_block = one("#add_edit_block")

  import van from "https://cdn.jsdelivr.net/gh/vanjs-org/van/public/van-1.5.3.min.js"
  import {Mcu, Printer, Stepper, Extruder, HeaterBed} from '/js/classes.js'
  import {c_Mcu} from '/js/components.js'
  import {BlockDialog} from '/js/components/block_dialog.js'

  const validate = (o)=>{
    for (const p of Object.keys(o)) {
      if (o[p].value === undefined && o[p].required === true) return false
    }
  }
  const config_block =(o)=>{
    let s = `[${o.name}]`
    for (const p of Object.keys(o)) {
      if (o[p].value !== undefined) {
        s = `${s}\n  ${p}: ${o[p].value}`
      }
    }
    return s
  }

  let config = {

  }



  function add_section(e) {
    const idx = e.target.dataset.idx
    console.log(idx)
    add_edit_block.showModal();
  }

  const block_dialog = BlockDialog()

  console.log(block_dialog)

  all("button").forEach(element => {
    element.addEventListener("click", ()=>block_dialog.showModal())
  });


  van.add(document.body, c_Mcu())
  van.add(document.body, block_dialog.element)

  let stepper_x = new Stepper('stepper_x', {step_pin: 'gpio17', homing_speed: '53'})
  let mcu = new Mcu('rp2040')
  console.log(validate(stepper_x)?"valid":"not valid")
  console.log(config_block(stepper_x))
  console.log(validate(mcu)?"valid":"not valid")
  console.log(config_block(mcu))
</script>
</body>
